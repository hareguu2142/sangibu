<% if (needsAuth) { %>
  <div class="auth-container">
    <h3>관리자 로그인</h3>
    <p>이 생활기록부의 관리자 Key를 입력하세요.</p>
    <form method="GET" action="/admin/<%= code %>" class="row">
      <input name="adminKey" type="password" placeholder="Admin Key" required autofocus>
      <button type="submit">로그인</button>
    </form>
    <% if (error) { %>
      <p class="error-message"><%= error %></p>
    <% } %>
  </div>
<% } else { %>
  <div class="row">
    <a class="pill <%= tab === 'students' ? 'active' : '' %>" href="/admin/<%= code %>?tab=students&adminKey=<%= adminKey %>">학생 명단</a>
    <a class="pill <%= tab === 'teachers' ? 'active' : '' %>" href="/admin/<%= code %>?tab=teachers&adminKey=<%= adminKey %>">교사코드 설정</a>
    <a class="pill <%= tab === 'subjects' ? 'active' : '' %>" href="/admin/<%= code %>?tab=subjects&adminKey=<%= adminKey %>">과목 설정</a>
  </div>
  <hr/>

  <% if (tab === 'teachers') { %>
    <h3>교사코드 설정</h3>
    <form method="POST" action="/admin/<%= code %>/teachers?adminKey=<%= adminKey %>" class="row">
      <input name="teacherId" placeholder="교사고유번호(예: TCH001)" required />
      <input name="name" placeholder="이름(예: 김교사)" required />
      <button>추가</button>
    </form>

    <table class="list" style="margin-top:16px;">
      <thead><tr><th>고유번호</th><th>이름</th><th>삭제</th></tr></thead>
      <tbody>
        <% teachers.forEach(t => { %>
          <tr>
            <td><%= t.teacherId %></td>
            <td><%= t.name %></td>
            <td>
              <form method="POST" action="/admin/<%= code %>/teachers/<%= t._id %>/delete?adminKey=<%= adminKey %>">
                <button class="secondary">삭제</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else if (tab === 'subjects') { %>
    <h3>과목 설정</h3>
    <form method="POST" action="/admin/<%= code %>/subjects?adminKey=<%= adminKey %>" class="row">
      <input name="subject" placeholder="추가할 과목명" required />
      <button>추가</button>
    </form>

    <table class="list" style="margin-top:16px;">
      <thead><tr><th>과목명</th><th>삭제</th></tr></thead>
      <tbody>
        <% subjects.forEach(s => { %>
          <tr>
            <td><%= s %></td>
            <td>
              <form method="POST" action="/admin/<%= code %>/subjects/delete?adminKey=<%= adminKey %>">
                <input type="hidden" name="subject" value="<%= s %>" />
                <button class="secondary">삭제</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <h3>학생 명단</h3>
    <form method="POST" action="/admin/<%= code %>/students?adminKey=<%= adminKey %>" class="row">
      <input name="grade" type="number" placeholder="학년" required />
      <input name="klass" type="number" placeholder="반" required />
      <input name="number" type="number" placeholder="번호" required />
      <input name="name" placeholder="이름" required />
      <input name="studentCardCode" placeholder="학생증코드" required />
      <button>추가</button>
    </form>

    <form method="POST" action="/admin/<%= code %>/students/upload?adminKey=<%= adminKey %>" enctype="multipart/form-data" style="margin-top:16px;">
      <div class="row">
        <input type="file" name="csv" accept=".csv" required />
        <button>CSV 업로드</button>
        <span class="pill">헤더: 학년,반,번호,이름,학생증코드</span>
      </div>
    </form>

    <table class="list" style="margin-top:16px;">
      <thead><tr><th>학년</th><th>반</th><th>번호</th><th>이름</th><th>학생증코드</th><th>삭제</th></tr></thead>
      <tbody>
        <% students.forEach(s => { %>
          <tr>
            <td><%= s.grade %></td>
            <td><%= s.klass %></td>
            <td><%= s.number %></td>
            <td><%= s.name %></td>
            <td><%= s.studentCardCode %></td>
            <td>
              <form method="POST" action="/admin/<%= code %>/students/<%= s._id %>/delete?adminKey=<%= adminKey %>">
                <button class="secondary">삭제</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } %>
<% } %>
